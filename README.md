# Тестовое задание для стажировки в VK Tech на позиции Backend Developer

## Чат-бот для голосования внутри чатов мэссенджера Mattermost

Язык программирования: **Go**  
База данных: **tarantool**

### Логирование
Действия логируются с помощью пакета `log/slog`.
Также если выбрать в конфигурации среду `local`, будет использован [пакет-обёртка](https://github.com/Exc0mmun1cad0/badaslog) для более красивых логов.

### Конфигурация

### Настройка dev-окружения
Для запуска бота необходим рабочий Mattermost-сервер с бд Postgres.  
Также нужно поднять бд Tarantool, которую бот использует.  
Следующие команды:
```bash
cd mattermost
mkdir -p ./volumes/app/mattermost/{config,data,logs,plugins,client/plugins,bleve-indexes}
sudo chown -R 2000:2000 ./volumes/app/mattermost
docker compose up -d
```
поднимает локально сервер Mattermost по адресу `localhost:8065` и сервер Postgres  

Для ***запуска самого бота*** нужно использовать
```
make bot-up
```
Данная команда с помощью `docker-compose.yml` собирает контейнер с приложение на ***Go*** и контейнер с бд ***Tarantool***


### Функционал
#### 1. Создание голосования
- Запрос:
```
!create_poll НАЗВАНИЕ_ОПРОСА
ВАРИАНТ 1
ВАРИАНТ 2
...
```
- Ответ при успешном выполнении:
```
New poll created: НАЗВАНИЕ_ОПРОСА
ID: ID_ГОЛОСОВАНИЯ
1) ВАРИАНТ 1
2) ВАРИАНТ 2
...
```
`ID` запроса будет использоваться в следующих командах  
Варианты нумеруются для более удобного голосования  
Если нужно создать опрос с ***несколькими вариантам*** ответов, то в запросе использовать `create_multipoll`

#### 2. Голосование
- Запрос:
```
!vote ID_ГОЛОСОВАНИЯ
ВАРИНТ(Ы)_ЧЕРЕЗ ПРОБЕЛ
```
- Ответ при успешном выполнении:
```
your vote was counted
```

#### 3. Просмотр результатов голосования
- Запрос:
```
!get_results ID_ГОЛОСОВАНИЯ
```
- Ответ при успешном выполнении:
```
Results:
1) КОЛИЧЕСТВО_ГОЛОСОВ
2) КОЛИЧЕСТВО_ГОЛОСОВ
...
```

#### 4. Завершение голосования  
Создатель голосования может завершить его.  
Можно будет только смотреть результаты голосования, но не голосовать или отменить голос.
- Запрос:
```
!finish_poll ID_ГОЛОСОВАНИЯ
```
- Ответ при успешном выполнении:
```
poll ID_ГОЛОСОВАНИЯ was finished
```

#### 5. Удаление голосования
Создатель голосования может удалить его.  
В таком случае все данные о нём, в том числе голоса и варианты ответов.  
При попытке запросить результаты будет выводиться сообщение что голосование не найдено.
- Запрос:
```
!delete-poll ID_ГОЛОСОВАНИЯ
```
- Ответ при успешном выполнении:
```
poll ID_ГОЛОСОВАНИЯ was deleted
```

#### Дополнительно. Отмена голоса
Если запрос ещё не закончен и пользователь уже проголосовал, у него есть возможность отменить голос.
- Запрос:
```
!retract_vote ID_ГОЛОСОВАНИЯ
```
- Ответ при успешном выполнении:
```
your vote was retracted
```